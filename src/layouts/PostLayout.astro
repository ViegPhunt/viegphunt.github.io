---
// Post layout - For individual articles (projects, writeups)
import BaseLayout from './BaseLayout.astro';
import Header from '@/components/Header';
import ScrollToTop from '@/components/ScrollToTop';
import Footer from '@/components/Footer.astro';
import Scrollbar from '@/components/Scrollbar';
import type { ImageMetadata } from 'astro';

export interface Props {
	title: string;
	description?: string;
	image?: string | ImageMetadata;
	imageAlt?: string;
	publishedTime?: string;
	modifiedTime?: string;
	tags?: string[];
	url?: string; // Optional GitHub/external URL
}

const {
	title,
	description,
	image,
	imageAlt,
	publishedTime,
	modifiedTime,
	tags = [],
	url,
} = Astro.props;
---

<BaseLayout
	title={title}
	description={description}
	image={image}
	imageAlt={imageAlt}
	type="article"
	publishedTime={publishedTime}
	modifiedTime={modifiedTime}
	tags={tags}
>
	<Scrollbar client:load />
	<div class="min-h-screen flex flex-col">
		<Header client:load pathname={Astro.url.pathname} />
		
		<main class="flex-1 w-[90%] max-w-[950px] mx-auto pt-[100px] pb-[20px] lg:pt-[160px] lg:pb-[50px]">
			<div class="w-full flex justify-center">
				<!-- Article Content -->
				<div class="w-full max-w-[1200px]">
					<!-- Article Header -->
					<div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
						<h1 class="mt-8 text-3xl md:text-5xl font-bold text-text leading-tight flex-1">
							{title}
						</h1>

						{url && (
							<a
								href={url}
								target="_blank"
								rel="noopener noreferrer"
								class="text-link md:text-lg no-underline hover:underline font-medium shrink-0 md:mb-2 group/link"
							>
								View on GitHub
								<i class="fa-solid fa-arrow-right text-xs transition-transform group-hover/link:translate-x-2"></i>
							</a>
						)}
					</div>
					
					{description && (
						<p class="text-[1.25rem] text-text mb-3">{description}</p>
					)}
					
					{tags.length > 0 && (
						<div class="mb-3 flex gap-2 flex-wrap items-center">
							<i class="fa-solid fa-hashtag"></i>
							{tags.map(tag => (
								<span class="px-2 py-1 bg-tag rounded-xl text-text text-xs">
									{tag}
								</span>
							))}
						</div>
					)}
					
					{publishedTime && (
						<div class="mb-3 text-base text-text flex items-center gap-2">
							<i class="fa-regular fa-clock translate-y-[-1.5px]"></i>
							<span>
								{new Date(publishedTime).toLocaleDateString('en-GB')}
							</span>
						</div>
					)}

					<article class="prose prose-lg max-w-none max-md:p-0
						prose-headings:text-text prose-headings:font-bold prose-headings:scroll-mt-[35px]
						prose-h1:text-[2.3rem] prose-h1:border-b prose-h1:border-border prose-h1:pb-3 prose-h1:mt-6 prose-h1:mb-3
						prose-h2:text-[2rem] prose-h2:border-b prose-h2:border-border prose-h2:pb-3 prose-h2:mt-6 prose-h2:mb-3
						prose-h3:text-[1.6rem] prose-h3:mt-6 prose-h3:mb-3
						prose-h4:text-[1.3rem] prose-h4:mt-6 prose-h4:mb-3
						prose-p:text-text prose-p:text-[1.2rem] prose-p:leading-relaxed prose-p:mb-3 prose-p:text-justify
						prose-a:text-link prose-a:text-[1.2rem] prose-a:underline prose-a:underline-offset-[4px] prose-a:decoration-link
						prose-strong:text-text prose-strong:text-[1.2rem] prose-strong:font-bold
						prose-em:text-text prose-em:text-[1.2rem] prose-em:italic
						prose-code:text-text prose-code:bg-tag prose-code:px-2 prose-code:py-[2px] prose-code:rounded-md prose-code:text-[0.9rem] prose-code:before:content-none prose-code:after:content-none
						prose-ul:text-text prose-ul:text-[1.2rem] prose-ul:my-2 prose-ul:pl-8 prose-ul:list-disc
						prose-ol:text-text prose-ol:text-[1.2rem] prose-ol:my-2 prose-ol:pl-8 prose-ol:list-decimal
						prose-li:text-text prose-li:text-[1.2rem] prose-li:my-2 prose-li:leading-relaxed
						prose-img:rounded prose-img:max-w-full prose-img:h-auto prose-img:my-4
						prose-hr:border-0 prose-hr:h-px prose-hr:bg-border prose-hr:my-8
						prose-table:w-full prose-table:text-text prose-table:border-collapse prose-table:my-8 prose-table:text-[1rem] prose-table:border prose-table:border-border prose-table:rounded-md prose-table:overflow-hidden
						prose-th:px-4 prose-th:py-2 prose-th:bg-tag prose-th:font-semibold prose-th:border prose-th:border-border
						prose-td:px-4 prose-td:py-2 prose-td:bg-surface prose-td:border prose-td:border-border
						prose-video:w-full prose-video:rounded">
						
						<!-- Article Content (slot) -->
						<slot />
					</article>
				</div>
			</div>
		</main>
		
		<ScrollToTop client:load />
		<Footer />
	</div>

    <script>
        document.addEventListener('astro:page-load', () => {
            const links = document.querySelectorAll('.prose a');
            
            links.forEach(link => {
                const href = link.getAttribute('href');
                if (!href) return;
                
                const isVideo = href.includes('user-attachments/assets') || href.match(/\.(mp4|webm|mov)$/i);
                
                if (isVideo) {
                    const video = document.createElement('video');
                    video.src = href;
                    video.controls = true;
                    video.playsInline = true;
                    video.className = 'w-full rounded-lg my-4 shadow-sm';

					link.parentNode?.replaceChild(video, link);
                }
            });
        });
    </script>
</BaseLayout>